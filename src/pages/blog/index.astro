---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="blog â€” justframe"
  description="Writeups on security research, AI red teaming, DeFi exploits, and CTF walkthroughs."
>
  <section class="pt-16 pb-24 md:pt-24 md:pb-32">
    <div class="flex items-center gap-4 mb-12">
      <span class="text-xs font-mono tracking-widest uppercase" style="color: var(--color-accent);">
        //
      </span>
      <h1 class="text-2xl md:text-3xl font-semibold" style="color: var(--color-text);">
        Blog
      </h1>
      <div class="flex-1 h-px" style="background: linear-gradient(90deg, var(--color-accent)33 0%, transparent 100%);"></div>
    </div>

    {posts.length === 0 ? (
      <div class="py-16 text-center">
        <p class="text-sm font-mono" style="color: var(--color-text-dim);">
          <span style="color: var(--color-accent);">$</span> ls ./posts
        </p>
        <p class="mt-2 text-sm" style="color: var(--color-text-muted);">
          Nothing here yet. First post incoming.
        </p>
      </div>
    ) : (
      <div class="grid gap-2">
        {posts.map((post, index) => (
          <a
            href={`/blog/${post.id}`}
            class="group flex flex-col md:flex-row md:items-baseline gap-1 md:gap-6 p-4 -mx-4 rounded-lg transition-all duration-200"
          >
            <time
              class="text-xs font-mono shrink-0 tabular-nums"
              style="color: var(--color-text-dim);"
              datetime={post.data.date.toISOString()}
            >
              {post.data.date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
              })}
            </time>
            <span
              class="font-medium transition-colors duration-200"
              style="color: var(--color-text-muted);"
            >
              {post.data.title}
            </span>
            {post.data.tags && (
              <span class="hidden md:flex items-center gap-2 ml-auto">
                {post.data.tags.slice(0, 3).map((tag: string) => (
                  <span class="tag">{tag}</span>
                ))}
              </span>
            )}
          </a>
        ))}
      </div>
    )}
  </section>
</BaseLayout>

<style>
  a.group:hover {
    background-color: var(--color-bg-alt);
  }

  a.group:hover span:not(.tag) {
    color: var(--color-text);
  }
</style>
